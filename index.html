<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Ivage Calendar Creator</title>
		<meta name="description" content="Creates iCal based on Ivago data">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="css/bootstrap.min.css">
		<style>
			body {
				padding-top: 50px;
				padding-bottom: 20px;
      }
		</style>
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="css/main.css">

		<script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
		<script language="javascript">
			function getURLParameter(sParam) {
				var sPageURL = window.location.search.substring(1);
				var sURLVariables = sPageURL.split('&');
				for (var i = 0; i < sURLVariables.length; i++) 	{
					var sParameterName = sURLVariables[i].split('=');
					if (sParameterName[0] == sParam) 		{
						return sParameterName[1];
					}
				}
			}

			function createICal() {
				var generator = new ICalGenerator();
				jQuery.getJSON("IvagoOphaalkalender2014.json", function(data) {
					generator.loadData(data["IvagoOphaalkalender2014"]);
					var sector = getURLParameter('sector');
					var a = document.createElement('a');
					a.setAttribute('href', 'data:application/octet-stream;charset=utf-8;base64,' + window.btoa(generator.generate(sector)));
					a.setAttribute('download', 'iCal-' + sector + '.ics');
					a.click();
					$('#downloadLink').attr('href', 'data:application/octet-stream;charset=utf-8;base64,' + window.btoa(generator.generate(sector)));
					$('#downloadLink').attr('download', 'iCal-' + sector + '.ics');
				});
			}
		</script>
	</head>
	<body>
		<!--[if lt IE 7]>
		<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		<![endif]-->
		<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">Common Tools</a>
				</div>
				<!--/.navbar-collapse -->
			</div>
		</div>

		<!-- Main jumbotron for a primary marketing message or call to action -->
		<div class="jumbotron">
			<div class="container">
				<h1>Ivago Calendar Creator</h1>
				<p>This page allows you to create a calendar in iCal format for the garbage collection rounds of Ivago, Ghent. The iCal format is a widely used format, understood by most calendering applications, among other Google Calendar, Mozilla Thunderbird, Microsoft Outlook...</p>
				<!--p><a class="btn btn-primary btn-lg" role="button">Learn more &raquo;</a></p-->
			</div>
		</div>

		<div class="container">
			<h3>Calendar settings</h3>
			<p>Select your address and desired calendar properties. This information is needed to find your zone. Garbage collection calendars depend on the zone in which you live. Under no circumstance will this information be stored or shared with third parties.</p>
			<form method="get" role="form">
				<div class="form-group">
					<div data-bind="visible: !dataLoaded()">
						<img src="img/ajax-loader.gif"/>
						<span>Loading data ...</span>
					</div>
				</div>
				<div class="form-group form-inline">
					<select data-bind="
						options: allCommunities,
						optionsText: 'name',
						optionsCaption: 'Choose community',
						value: selectedCommunity,
						enable: dataLoaded" class="form-control"></select>
					<select data-bind="
						options: communityStreets,
						optionsText: 'name',
						value: selectedStreet,
						optionsCaption: 'Choose street...',
						enable: selectedCommunity" class="form-control"></select> 
					<select data-bind="
						options: streetDivisions,
						optionsText: 'label',
						value: selectedStreetDivision,
						optionsCaption: 'Choose street part...',
						enable: isStreetDivided
						visible: isStreetDivided" class="form-control"></select> 
				</div>
				<div class="form-group" data-bind="visible: selectedSector()">
					<p>You are in sector: <span data-bind="text: selectedSector()"> </span></p>
				</div>
				<input data-bind="value: selectedSector()" type="hidden" name="sector"/>
				<button type="button" class="btn btn-default" data-bind="enable: selectedSector(), click: createICal.bind($data.selectedSector())">Create iCal &raquo;</button>
			</form>
			<hr>
			<a id="downloadLink" href="">Download iCal</a>

			<footer>
				<p>&copy; drhoet 2014</p>
			</footer>
		</div> <!-- /container -->

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script>window.jQuery || document.write('<scr'+'ipt src="js/vendor/jquery-1.11.0.min.js"><\/script>')</script>
		<script src="js/vendor/bootstrap.min.js"></script>
		<script src="js/vendor/knockout-3.1.0.js"></script>
		<script src="js/vendor/moment.min.js"></script>
		<script src="js/selectZoneViewModel.js"></script>
		<script src="js/iCalGenerator.js"></script>
		<script language="javascript">
			var model = new SelectZoneViewModel();
			ko.applyBindings(model);
			jQuery.getJSON(
				//"http://datatank.gent.be/MilieuEnNatuur/IVAGO-Stratenlijst.json", function(data){
				"IVAGO-Stratenlijst.json", function(data){
				model.loadData(data["IVAGO-Stratenlijst"]);
			});
		</script>
	</body>
</html>
